!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.jQueryUITreeControl=t():e.jQueryUITreeControl=t()}(this,()=>(()=>{"use strict";var e,t,s={d:(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},n={};s.r(n),s.d(n,{TreeControl:()=>l,TreeDataFormat:()=>t,TreeDataType:()=>e}),function(e){e[e.Json=1]="Json",e[e.Xml=2]="Xml"}(e||(e={})),function(e){e[e.Linear=1]="Linear",e[e.Hierarchy=2]="Hierarchy"}(t||(t={}));const i={containerid:null,url:null,async:!1,dataset:null,datatype:e.Json,dataformat:t.Hierarchy,class_node_collapse:"ui-icon-folder-collapsed",class_node_expand:"ui-icon-folder-open",class_node_item:"ui-icon-document",collapse_tree:!1,class_node_highlight:"ui-state-highlight",class_node_add:"ui-icon-plusthick",class_node_remove:"ui-icon-minusthick",show_button_check:!1,show_button_add:!1,show_button_remove:!1,node_remove_message:"Are you sure you want to remove this node?",onstart:()=>{},onend:()=>{},onprocessingstart:()=>{},onprocessingcomplete:()=>{},onprocessingerror:()=>{},onbeforedataconversion:()=>{},onafterdataconversion:()=>{},onrenderstart:()=>{},onrendercomplete:()=>{},onbeforenodeinsert:()=>{},onafternodeinsert:()=>{},onselectednode:()=>{},onbeforeaddnode:()=>{},onafteraddnode:()=>{},onbeforeremovenode:()=>{},onafterremovenode:()=>{},onaddnode:()=>{},onremovenode:()=>{},onnodecheckselected:()=>{}};class o{constructor(e){this.settings=e}async loadData(){if(this.settings.url&&this.settings.url.length>0){const e=this.getDataType();try{const t=await this.makeAjaxRequest(e);this.settings.dataset=t}catch(e){const t=e;this.settings.onprocessingerror(t.xhr||t,t.ajaxOptions||"",t.thrownError||t.message)}}}getDataType(){switch(this.settings.datatype){case e.Json:return"json";case e.Xml:return"xml";default:return"json"}}makeAjaxRequest(e){return new Promise((t,s)=>{$.ajax({type:"GET",async:this.settings.async,url:this.settings.url,dataType:e,success:e=>{t(e)},error:(e,t,n)=>{s({xhr:e,ajaxOptions:t,thrownError:n})}})})}}class a{constructor(e){this.settings=e,this.treeDataStructure=[]}convertData(){switch(this.settings.onbeforedataconversion(),this.settings.datatype){case e.Json:this.convertJsonData();break;case e.Xml:this.convertXmlData()}return this.settings.onafterdataconversion(),this.treeDataStructure}convertJsonData(){switch(this.settings.dataformat){case t.Linear:this.convertJsonLinearToTreeObject(this.settings.dataset.root);break;case t.Hierarchy:this.treeDataStructure=this.settings.dataset.root}}convertXmlData(){switch(this.settings.dataformat){case t.Linear:this.convertLinearXmlToTreeObject(this.settings.dataset);break;case t.Hierarchy:this.convertHierarchyXmlToTreeObject(this.settings.dataset)}}convertJsonLinearToTreeObject(e){e.forEach(e=>{const t=this.getNodeObjectFromJson(e);0===this.treeDataStructure.length||0===t.parentId?this.treeDataStructure.push(t):this.addNodeToTreeDataStructure(this.treeDataStructure,t)})}convertLinearXmlToTreeObject(e){e.find("node").each((e,t)=>{const s=this.getNodeObjectFromXml($(t));0===this.treeDataStructure.length||0===s.parentId?this.treeDataStructure.push(s):this.addNodeToTreeDataStructure(this.treeDataStructure,s)})}convertHierarchyXmlToTreeObject(e){e.find("node").each((e,t)=>{const s=this.getNodeObjectFromXml($(t));0===this.treeDataStructure.length||0===s.parentId?this.treeDataStructure.push(s):this.addNodeToTreeDataStructure(this.treeDataStructure,s)})}getNodeObjectFromJson(e){const t={id:e.id,name:e.name,parentId:e.parentId,href:e.href??void 0,target:e.target??void 0,tooltip:e.tooltip??void 0,buttoncheck:e.buttoncheck??void 0,buttonadd:e.buttonadd??void 0,buttonremove:e.buttonremove??void 0,isdisabled:e.isdisabled??void 0,ischecked:e.ischecked??void 0,classnodeicon:e.classnodeicon??void 0,childnodes:[]};for(const s in e)s in t||(t[s]=e[s]);return t}getNodeObjectFromXml(e){let t=0;null!=e.parent().attr("id")?t=e.parent().attr("id"):null!=e.attr("parentId")&&(t=e.attr("parentId"));const s={id:e.attr("id"),name:e.attr("name"),parentId:t,href:e.attr("href")??void 0,target:e.attr("target")??void 0,tooltip:e.attr("tooltip")??void 0,buttoncheck:"true"===e.attr("buttoncheck")||void 0,buttonadd:"true"===e.attr("buttonadd")||void 0,buttonremove:"true"===e.attr("buttonremove")||void 0,isdisabled:"true"===e.attr("isdisabled")||void 0,ischecked:"true"===e.attr("ischecked")||void 0,classnodeicon:e.attr("classnodeicon")??void 0,childnodes:[]},n=e[0]?.attributes;return n&&Array.from(n).forEach(e=>{e.name in s||(s[e.name]=e.value)}),s}addNodeToTreeDataStructure(e,t){for(let s=0;s<e.length;s++){const n=e[s];if(n){if(n.id===t.parentId){n.childnodes&&0!==n.childnodes.length||(n.childnodes=[]),n.childnodes.push(t);break}Array.isArray(n.childnodes)&&this.addNodeToTreeDataStructure(n.childnodes,t)}}}}class r{constructor(e){this.settings=e,this.displayTree=""}buildTree(e){return this.settings.onrenderstart(),this.addNodeToDisplayTree(e),this.settings.onrendercomplete(),this.displayTree}addNodeToDisplayTree(e){0===this.displayTree.length?this.displayTree+="<ul style='list-style-type:none;'>":this.displayTree+="<ul style='list-style-type:none; display:none;'>",e.forEach(e=>{this.settings.onbeforenodeinsert(e),this.displayTree+=this.createNode(e),this.settings.onafternodeinsert(e),e.childnodes&&e.childnodes.length>0&&this.addNodeToDisplayTree(e.childnodes)}),this.displayTree+="</ul>"}createNode(e){let t="",s=20;const n=["id","name","parentId","href","target","tooltip","buttoncheck","buttonadd","buttonremove","isdisabled","ischecked","classnodeicon","childnodes"];t+=`<li nodeid='${e.id}'`;for(const s in e)n.indexOf(s)<0&&(t+=` ${s}='${e[s]}'`);return t+=">",t+="<div>",t+="<span class='ui-icon ",e.classnodeicon&&e.classnodeicon.length>0?t+=e.classnodeicon:e.childnodes&&e.childnodes.length>0?this.settings.collapse_tree?t+=this.settings.class_node_expand:t+=this.settings.class_node_collapse:t+=this.settings.class_node_item,t+="' data-action='nav_items' style='position:absolute; margin-top:1px;'></span>",(e.buttoncheck||null==e.buttoncheck&&this.settings.show_button_check)&&(t+=`<input type='checkbox' style='position:absolute; margin-top:1px;margin-left:${s}px;'`,e.isdisabled&&(t+=" disabled='true'"),!0===e.ischecked?t+=` checked='true' data-ischecked=${e.ischecked}`:t+=" data-ischecked='false'",t+="></input>",s+=20),(e.buttonadd||null==e.buttonadd&&this.settings.show_button_add)&&(t+=`<span class='ui-icon ${this.settings.class_node_add}' data-action='add' style='position:absolute; margin-top:1px;margin-left:${s}px;'></span>`,s+=20),(e.buttonremove||null==e.buttonremove&&this.settings.show_button_remove)&&(t+=`<span class='ui-icon ${this.settings.class_node_remove}' data-action='remove' style='position:absolute; margin-top:1px;margin-left:${s}px;'></span>`,s+=20),e.href&&(t+=`<a href='${e.href}' target='${e.target||""}'>`),t+=`<span style='margin-left:${s}px;' data-action='text'`,e.tooltip&&(t+=` title='${e.tooltip}'`),t+=`>${e.name}</span>`,e.href&&(t+="</a>"),t+="</div>",t+="</li>",t}}class d{constructor(e){this.settings=e,this.bindEvents()}bindEvents(){const e=$.fn.btechcotree;$(document).on("click","li div span[data-action='nav_items']",t=>{e.ToggleCaratIcon($(t.currentTarget)),e.ToggleTree($(t.currentTarget))}),$(document).on("click","li div span[data-action='text']",e=>{this.handleTextClick(e)}),$(document).on("click","li div input[type='checkbox']",e=>{this.handleCheckboxClick(e)}),$(document).on("click","li div span[data-action='add']",e=>{this.handleAddClick(e)}),$(document).on("click","li div span[data-action='remove']",e=>{this.handleRemoveClick(e)})}handleTextClick(e){const t=$(e.currentTarget),s=t.parent("div").parent("li").attr("nodeid"),n=t.parent("div").parent("li");this.settings.onselectednode(s,n,e),this.highlightNode(t,!0)}handleCheckboxClick(e){const t=$(e.currentTarget),s=t.parent("div").parent("li").attr("nodeid"),n=t.parent("div").parent("li");this.settings.onnodecheckselected(s,n,e),this.selectParentChildCheckBox(t,t.is(":checked"))}handleAddClick(e){const t=$(e.currentTarget),s=t.parent("div").parent("li").attr("nodeid"),n=t.parent("div").parent("li");this.settings.onbeforeaddnode(s,n,e),this.highlightNode(t,!0),this.settings.onaddnode(s,n,e),this.settings.onafteraddnode(s,n,e)}handleRemoveClick(e){const t=$(e.currentTarget),s=t.parent("div").parent("li").attr("nodeid"),n=t.parent("div").parent("li");this.settings.onbeforeremovenode(s,n,e),this.highlightNode(t,!0);confirm(this.settings.node_remove_message)?this.settings.onremovenode(s,n,e):this.highlightNode(t,!1),this.settings.onafterremovenode(s,n,e)}highlightNode(e,t){$(`#${this.settings.containerid} ul li div span[data-action='text']`).removeClass(this.settings.class_node_highlight),t&&e.parent("div").parent("li").find("span[data-action='text']:first").addClass(this.settings.class_node_highlight)}selectParentChildCheckBox(e,t){this.selectCheckbox(e,t),e.parent("div").parent("li").next("ul").find("input[type='checkbox']").each((e,s)=>{this.selectCheckbox($(s),t)}),e.parents("ul").prev("li").find("div input[type='checkbox']").each((e,s)=>{this.selectCheckbox($(s),t)})}selectCheckbox(e,t){t?(e.prop("checked",!0),e.attr("data-ischecked","true")):(e.removeAttr("checked"),e.attr("data-ischecked","false"))}standardizeCheckSelection(){$(`#${this.settings.containerid} ul li div`).find("input[type='checkbox']").each((e,t)=>{const s=$(t);if(s.is(":checked")&&s.attr("data-ischecked")&&s.parent("div").parent("li").next("ul").children().find("input[type='checkbox']").length>0){let e=!1;s.parent("div").parent("li").next("ul").children().each((t,s)=>{const n=$(s).find("input[type='checkbox']");n.is(":checked")&&n.attr("data-ischecked")&&(e=!0)}),e||(s.removeAttr("checked"),s.attr("data-ischecked","false"))}}),$(`#${this.settings.containerid} ul li div`).find("input[type='checkbox'][checked='true']").each((e,t)=>{$(t).parents("ul").prev("li").each((e,t)=>{$(t).find("input[type='checkbox']").attr("checked","true"),$(t).find("input[type='checkbox']").attr("data-ischecked","true")})})}}class c{constructor(e){this.settings=e}getRootNodes(){return $(`#${this.settings.containerid}> ul > li > div > span:nth-child(1)`)}toggleTree(e){e.parent("div").parent("li").next("ul").toggle()}toggleCaratIcon(e){e.each((e,t)=>{const s=$(t);s.hasClass(this.settings.class_node_item)||(s.hasClass(this.settings.class_node_expand)?(s.removeClass(this.settings.class_node_expand),s.addClass(this.settings.class_node_collapse)):s.hasClass(this.settings.class_node_collapse)?(s.removeClass(this.settings.class_node_collapse),s.addClass(this.settings.class_node_expand)):s.addClass(this.settings.class_node_expand))})}expandCollapseTree(e,t){t?e.parent("div").parent("li").next("ul").is(":visible")||(e.parent("div").parent("li").next("ul").show(),this.toggleCaratIcon(e)):e.parent("div").parent("li").next("ul").is(":visible")&&(e.parent("div").parent("li").next("ul").hide(),this.toggleCaratIcon(e))}expand(){const e=this.getRootNodes();this.expandCollapseTree(e,!0)}collapse(){const e=this.getRootNodes();this.expandCollapseTree(e,!1)}toggle(){const e=this.getRootNodes();this.toggleCaratIcon(e),this.toggleTree(e)}enableRootCarats(){const e=this.getRootNodes();this.toggleCaratIcon(e),this.toggleTree(e),this.settings.collapse_tree&&(this.toggleCaratIcon(e),this.toggleTree(e))}}class l{constructor(e){this.settings={...i,...e},this.initializeComponents()}initializeComponents(){this.dataLoader=new o(this.settings),this.dataConverter=new a(this.settings),this.treeRenderer=new r(this.settings),this.eventHandlers=new d(this.settings),this.treeOperations=new c(this.settings)}async initialize(){this.settings.onstart(),this.settings.onprocessingstart(),await this.buildTreeDataStructure(),this.settings.onprocessingcomplete(),this.settings.onrenderstart(),this.buildTree(),this.settings.onrendercomplete(),this.settings.onend()}async buildTreeDataStructure(){await this.dataLoader.loadData();const e=this.dataConverter.convertData();this.renderTree(e)}renderTree(e){const t=this.treeRenderer.buildTree(e);$(`#${this.settings.containerid}`).append(t)}buildTree(){this.treeOperations.enableRootCarats(),this.eventHandlers.standardizeCheckSelection()}getRootNodes(){return this.treeOperations.getRootNodes()}toggleTree(e){this.treeOperations.toggleTree(e)}toggleCaratIcon(e){this.treeOperations.toggleCaratIcon(e)}expandCollapseTree(e,t){this.treeOperations.expandCollapseTree(e,t)}expand(){this.treeOperations.expand()}collapse(){this.treeOperations.collapse()}toggle(){this.treeOperations.toggle()}}const h=new Map;$.fn.btechcotree=function(e={}){return this.each(function(){const t=$(this).attr("id");if(!t)return void console.error("Tree control requires an element with an ID");const s={...e,containerid:t},n=new l(s);h.set(t,n),n.initialize().catch(e=>{console.error("Failed to initialize tree control:",e)})})};const p=$.fn.btechcotree;return p.GetRootNodes=function(){const e=Array.from(h.values())[0];return e?e.getRootNodes():$()},p.ToggleTree=function(e){const t=Array.from(h.values())[0];t&&t.toggleTree(e)},p.ToggleCaratIcon=function(e){const t=Array.from(h.values())[0];t&&t.toggleCaratIcon(e)},p.ExpandCollapseTree=function(e,t){const s=Array.from(h.values())[0];s&&s.expandCollapseTree(e,t)},p.Expand=function(){const e=Array.from(h.values())[0];e&&e.expand()},p.Collapse=function(){const e=Array.from(h.values())[0];e&&e.collapse()},p.Toggle=function(){const e=Array.from(h.values())[0];e&&e.toggle()},n})());